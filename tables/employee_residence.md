# Employee Residence TABLE

The **employee residence** table holds the location of employment for a job listing

- Schema: group5
- Table: employee_residence
- Columns: residence_id, residence

[See Also: Acronyms & Definitions](../definitions/TABLE_OF_DEFINITIONS.md)

## CREATE TABLE Schema.EMPLOYEE_RESIDENCE

```sql
CREATE TABLE group5.employee_residence (
	residence_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	residence CHAR(2) NOT NULL UNIQUE
);

```

## Verify Tables Structure

```sql
\d+ group5.employee_residence
```

- Table Structure

```bash
                                               Table "group5.employee_residence"
    Column    |     Type     | Collation | Nullable |             Default              | Storage  | Stats target | Description
--------------+--------------+-----------+----------+----------------------------------+----------+--------------+-------------
 residence_id | integer      |           | not null | generated by default as identity | plain    |              |
 residence    | character(2) |           | not null |                                  | extended |              |
Indexes:
    "employee_residence_pkey" PRIMARY KEY, btree (residence_id)
    "employee_residence_residence_key" UNIQUE CONSTRAINT, btree (residence)
Access method: heap

```

## INSERT INTO Schema.Table

- If you are unable to use the \copy function below, then follow [this link](../table_csv/employee_residence.txt) to use INSERT INTO data for this table. Simply copy and paste the data into your terminal.

[INSERT INTO: employee_residence.txt](../table_csv/employee_residence.txt)

## OR \copy Schema.Table Data

The employee_residence.csv is located in /table_csv: [CSV File Location](../table_csv/employee_residence.csv)

```sql
\copy group5.employee_residence (residence) from employee_residence.csv with csv header
```

## View of Table

```sql
SELECT * FROM group5.employee_residence;
```

```bash
 residence_id | residence
--------------+-----------
            1 | ES
            2 | US
            3 | CA
            4 | DE
            5 | GB
            6 | NG
            7 | IN
            8 | HK
            9 | PT
           10 | NL
           11 | CH
           12 | CF
           . . .
           . . .
           72 | BG
           73 | JE
           74 | RS
           75 | NZ
           76 | MD
           77 | LU
           78 | MT
(78 rows)
```

## View of MAIN Table Before ALTER & UPDATE

```sql
SELECT * FROM group5.main LIMIT 5;
```

```bash
 listing_id | employee_residence |         job_title         | employment_type | experience_id | work_year_id | location_id | salary_id | remote_ratio_id | size_id
------------+--------------------+---------------------------+-----------------+---------------+--------------+-------------+-----------+-----------------+---------
        122 | US                 | Machine Learning Engineer | FT              |             1 |            1 |           2 |       122 |               3 |       2
        123 | US                 | Machine Learning Engineer | FT              |             1 |            1 |           2 |       123 |               3 |       2
        124 | US                 | Analytics Engineer        | FT              |             1 |            1 |           2 |       118 |               1 |       2
        125 | US                 | Analytics Engineer        | FT              |             1 |            1 |           2 |       125 |               1 |       2
        126 | US                 | Data Engineer             | FT              |             1 |            1 |           2 |        86 |               1 |       2
(5 rows)
```

## CREATE REFERENTIAL FROM MAIN TO NEW TABLE

- ADD Reference (id) Column to MAIN

```sql
ALTER TABLE group5.main ADD COLUMN residence_id INT;
```

- Child Reference from MAIN Foreign Key to Parent Tables Primay Key (id)

```sql
UPDATE group5.main
SET residence_id = employee_residence.residence_id
FROM group5.employee_residence
WHERE group5.main.employee_residence = group5.employee_residence.residence;

```

- Drop Unreferenced Column from MAIN

```sql
ALTER TABLE group5.main DROP COLUMN employee_residence;
```

- Add ON DELETE CASCADE to MAIN

```sql
ALTER TABLE group5.main
ADD CONSTRAINT employee_residence_fk_listing
FOREIGN KEY (residence_id)
REFERENCES group5.employee_residence (residence_id)
ON DELETE CASCADE;

```

## View of MAIN Table After ALTER & UPDATE

```sql
SELECT * FROM group5.main LIMIT 50;
```

```bash
 listing_id |         job_title         | employment_type | experience_id | work_year_id | location_id | salary_id | remote_ratio_id | size_id | residence_id
------------+---------------------------+-----------------+---------------+--------------+-------------+-----------+-----------------+---------+--------------
        122 | Machine Learning Engineer | FT              |             1 |            1 |           2 |       122 |               3 |       2 |            2
        123 | Machine Learning Engineer | FT              |             1 |            1 |           2 |       123 |               3 |       2 |            2
        124 | Analytics Engineer        | FT              |             1 |            1 |           2 |       118 |               1 |       2 |            2
       2534 | Data Scientist            | FT              |             1 |            2 |           2 |      1963 |               1 |       2 |            2
        125 | Analytics Engineer        | FT              |             1 |            1 |           2 |       125 |               1 |       2 |            2
        . . .
        . . .
        157 | Applied Data Scientist    | FT              |             2 |            1 |           7 |       157 |               3 |       3 |            7
        158 | Data Analyst              | FT              |             2 |            1 |           5 |       158 |               1 |       2 |            5
        159 | Data Analyst              | FT              |             2 |            1 |           5 |       159 |               1 |       2 |            5
(5 rows)
```
