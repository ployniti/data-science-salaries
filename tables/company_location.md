# Company Location TABLE

The **company location** table holds the regional locations for all job listings

- Schema: group5
- Table: company_location
- Columns: location_id, location

[See Also: Acronyms & Definitions](../definitions/TABLE_OF_DEFINITIONS.md)

## CREATE TABLE Schema.COMPANY_LOCATION

```sql
CREATE TABLE group5.company_location (
	location_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	location CHAR(2) NOT NULL UNIQUE
);

```

## Verify Tables Structure

```sql
\d+ group5.company_location
```

- Table Structure

```bash
                                               Table "group5.company_location"
   Column    |     Type     | Collation | Nullable |             Default              | Storage  | Stats target | Description
-------------+--------------+-----------+----------+----------------------------------+----------+--------------+-------------
 location_id | integer      |           | not null | generated by default as identity | plain    |              |
 location    | character(2) |           | not null |                                  | extended |              |
Indexes:
    "company_location_pkey" PRIMARY KEY, btree (location_id)
    "company_location_location_key" UNIQUE CONSTRAINT, btree (location)
Access method: heap
```

## INSERT INTO Schema.Table

- If you are unable to use the \copy function below, then follow [this link](../table_csv/company_location.txt) to use INSERT INTO data for this table. Simply copy and paste the data into your terminal.

[INSERT INTO: company_location.txt](../table_csv/company_location.txt)

## OR \copy Schema.Table Data

The company_location.csv is located in /table_csv: [CSV File Location](../table_csv/company_location.csv)

```sql
\copy group5.company_location (location) from company_location.csv with csv header;
```

## View of Table

```sql
SELECT * FROM group5.company_location;
```

```bash
 location_id | location
-------------+----------
           1 | ES
           2 | US
           3 | CA
           4 | DE
           5 | GB
           6 | NG
           7 | IN
           8 | HK
           . . .
           . . .
          71 | MD
          72 | MT
(72 rows)
```

## View of MAIN Table Before ALTER & UPDATE

```sql
SELECT * FROM group5.main LIMIT 5;
```

```bash
 listing_id | company_location | salary | remote_ratio | company_size | employee_residence |     job_title     | employment_type | experience_id | work_year_id
------------+------------------+--------+--------------+--------------+--------------------+-------------------+-----------------+---------------+--------------
         44 | US               | 110680 |            0 | L            | US                 | Applied Scientist | FT              |             3 |            1
         45 | US               | 270703 |            0 | M            | US                 | Data Engineer     | FT              |             1 |            1
         46 | US               | 221484 |            0 | M            | US                 | Data Engineer     | FT              |             1 |            1
         47 | US               | 212750 |          100 | M            | US                 | Data Scientist    | FT              |             1 |            1
         48 | US               | 185000 |          100 | M            | US                 | Data Scientist    | FT              |             1 |            1
(5 rows)
```

## CREATE REFERENTIAL FROM MAIN TO NEW TABLE

- ADD Reference (id) Column to MAIN

```sql
ALTER TABLE group5.main ADD COLUMN location_id INT;
```

- Child Reference from MAIN Foreign Key to Parent Tables Primay Key (id)

```sql
UPDATE group5.main
SET location_id = company_location.location_id
FROM group5.company_location
WHERE group5.main.company_location = group5.company_location.location;

```

- Drop Unreferenced Column from MAIN

```sql
ALTER TABLE group5.main DROP COLUMN company_location;
```

- Add ON DELETE CASCADE to MAIN

```sql
ALTER TABLE group5.main
ADD CONSTRAINT location_fk_listing
FOREIGN KEY (location_id)
REFERENCES group5.company_location (location_id)
ON DELETE CASCADE;

```

## View of MAIN Table After ALTER & UPDATE

```sql
SELECT * FROM group5.main LIMIT 5;
```

```bash
 listing_id | salary | remote_ratio | company_size | employee_residence |     job_title     | employment_type | experience_id | work_year_id | location_id
------------+--------+--------------+--------------+--------------------+-------------------+-----------------+---------------+--------------+-------------
       1632 | 234100 |          100 | M            | US                 | ML Engineer       | FT              |             1 |            1 |           2
       2560 |  78000 |          100 | M            | BR                 | BI Analyst        | FT              |             2 |            2 |          24
         44 | 110680 |            0 | L            | US                 | Applied Scientist | FT              |             3 |            1 |           2
         45 | 270703 |            0 | M            | US                 | Data Engineer     | FT              |             1 |            1 |           2
         46 | 221484 |            0 | M            | US                 | Data Engineer     | FT              |             1 |            1 |           2
(5 rows)
```
