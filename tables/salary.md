# Salary TABLE

The **salary** table holds the offered salaries (in USD) for each job listing

- Schema: group5
- Table: salary
- Columns: salary_id, salary_in_usd


## CREATE TABLE Schema.SALARY

```sql
CREATE TABLE group5.salary (
	salary_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
	salary_in_usd REAL NOT NULL UNIQUE
);

```

## Verify Tables Structure

```sql
\d+ group5.salary
```

- Table Structure

```bash
                                                  Table "group5.salary"
    Column     |  Type   | Collation | Nullable |             Default              | Storage | Stats target | Description
---------------+---------+-----------+----------+----------------------------------+---------+--------------+-------------
 salary_id     | integer |           | not null | generated by default as identity | plain   |              |
 salary_in_usd | real    |           | not null |                                  | plain   |              |
Indexes:
    "salary_pkey" PRIMARY KEY, btree (salary_id)
    "salary_salary_in_usd_key" UNIQUE CONSTRAINT, btree (salary_in_usd)
Access method: heap
```

## INSERT INTO Schema.Table

- If you are unable to use the \copy function below, then follow [this link](../table_csv/salary.txt) to use INSERT INTO data for this table. Simply copy and paste the data into your terminal.

[INSERT INTO: salary.txt](../table_csv/salary.txt)

## OR \copy Schema.Table Data

The salary_unique.csv is located in /table_csv: [CSV File Salary](../table_csv/salary_unique.csv)

```sql
\copy group5.salary (salary_in_usd) from salary_unique.csv with csv header;
```

## View of Table

```sql
SELECT * FROM group5.salary WHERE salary_id > 3700;
```

```bash
 salary_id | salary_in_usd
-----------+---------------
      3703 |         40189
      3704 |         12901
      3706 |          5882
      3719 |         74000
      3721 |         18000
      3724 |         18907
      . . .
      . . .
      3745 |         45618
      3747 |        119059
      3748 |        423000
      3749 |         28369
      3751 |        412000
      3755 |         94665
(28 rows)
```

## View of MAIN Table Before ALTER & UPDATE

```sql
SELECT * FROM group5.main LIMIT 5;
```

```bash
 listing_id | salary | remote_ratio | company_size | employee_residence |     job_title     | employment_type | experience_id | work_year_id | location_id
------------+--------+--------------+--------------+--------------------+-------------------+-----------------+---------------+--------------+-------------
       1632 | 234100 |          100 | M            | US                 | ML Engineer       | FT              |             1 |            1 |           2
       2560 |  78000 |          100 | M            | BR                 | BI Analyst        | FT              |             2 |            2 |          24
         44 | 110680 |            0 | L            | US                 | Applied Scientist | FT              |             3 |            1 |           2
         45 | 270703 |            0 | M            | US                 | Data Engineer     | FT              |             1 |            1 |           2
         46 | 221484 |            0 | M            | US                 | Data Engineer     | FT              |             1 |            1 |           2
(5 rows)
```

## CREATE REFERENTIAL FROM MAIN TO NEW TABLE

- ADD Reference (id) Column to MAIN

```sql
ALTER TABLE group5.main ADD COLUMN salary_id INT;
```

- Child Reference from MAIN Foreign Key to Parent Tables Primay Key (id)

```sql
UPDATE group5.main
SET salary_id = salary.salary_id
FROM group5.salary
WHERE group5.main.salary = group5.salary.salary_in_usd;

```

- Drop Unreferenced Column from MAIN

```sql
ALTER TABLE group5.main DROP COLUMN salary;
```

- Add ON DELETE CASCADE to MAIN

```sql
ALTER TABLE group5.main 
ADD CONSTRAINT salary_fk_listing
FOREIGN KEY (salary_id)
REFERENCES group5.salary (salary_id) 
ON DELETE CASCADE;

```

## View of MAIN Table After ALTER & UPDATE

```sql
SELECT * FROM group5.main LIMIT 5;
```

```bash
 listing_id | remote_ratio | company_size | employee_residence |             job_title             | employment_type | experience_id | work_year_id | location_id | salary_id
------------+--------------+--------------+--------------------+-----------------------------------+-----------------+---------------+--------------+-------------+-----------
         82 |          100 | M            | PT                 | Machine Learning Engineer         | FT              |             1 |            1 |           2 |        19
         83 |          100 | S            | IN                 | Applied Machine Learning Engineer | FT              |             2 |            1 |           4 |        83
         84 |           50 | L            | IN                 | AI Developer                      | FT              |             3 |            2 |           7 |        84
         85 |          100 | L            | NL                 | Machine Learning Engineer         | FT              |             2 |            1 |           9 |        85
         86 |            0 | M            | US                 | Business Intelligence Engineer    | FT              |             1 |            1 |           2 |        86
(5 rows)
```
