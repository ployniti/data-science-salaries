# Work Year TABLE

The **work year** table holds the years for which the data set has job listings

- Schema: group5
- Table: work_year
- Columns: work_year_id, work_year

## CREATE TABLE Schema.WORK_YEAR

```sql
CREATE TABLE group5.work_year (
		work_year_id INT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
		work_year INT NOT NULL UNIQUE
);
```

## Verify Tables Structure

```sql
\d+ group5.work_year
```

- Table Structure

```bash
                                                Table "group5.work_year"

    Column    |  Type   | Collation | Nullable |             Default              | Storage | Stats target | Description
--------------+---------+-----------+----------+----------------------------------+---------+--------------+-------------
 work_year_id | integer |           | not null | generated by default as identity | plain   |              |
 work_year    | integer |           | not null |                                  | plain   |              |

Indexes:
    "work_year_pkey" PRIMARY KEY, btree (work_year_id)
    "work_year_work_year_key" UNIQUE CONSTRAINT, btree (work_year)
Access method: heap
```

## INSERT INTO Schema.Table

```sql
INSERT INTO group5.work_year (work_year) VALUES (2023), (2022), (2021), (2020);
```

- View Table

```sql
SELECT * FROM group5.work_year;
```

```bash
 work_year_id | work_year
--------------+-----------
            1 |      2023
            2 |      2022
            3 |      2021
            4 |      2020
(4 rows)
```

## View of MAIN Table Before ALTER & UPDATE

```sql
SELECT * FROM group5.main LIMIT 5;
```

```bash
 listing_id | work_year | company_location | salary | remote_ratio | company_size | employee_residence |        job_title         | employment_type | experience_id
------------+-----------+------------------+--------+--------------+--------------+--------------------+--------------------------+-----------------+---------------
          1 |      2023 | ES               |  85847 |          100 | L            | ES                 | Principal Data Scientist | FT              |             1
          2 |      2023 | US               |  30000 |          100 | S            | US                 | ML Engineer              | CT              |             2
          3 |      2023 | US               |  25500 |          100 | S            | US                 | ML Engineer              | CT              |             2
          4 |      2023 | CA               | 175000 |          100 | M            | CA                 | Data Scientist           | FT              |             1
          5 |      2023 | CA               | 120000 |          100 | M            | CA                 | Data Scientist           | FT              |             1
(5 rows)
```

## CREATE REFERENTIAL FROM MAIN TO NEW TABLE

- ADD Reference (id) Column to MAIN

```sql
ALTER TABLE group5.main ADD COLUMN work_year_id INT;
```

- Child Reference from MAIN Foreign Key to Parent Tables Primay Key (id)

```sql
UPDATE group5.main
SET work_year_id = work_year.work_year_id
FROM group5.work_year
WHERE group5.main.work_year = group5.work_year.work_year;
```

- Drop Unreferenced Column from MAIN

```sql
ALTER TABLE group5.main DROP COLUMN work_year;
```

- Add ON DELETE CASCADE to MAIN

```sql
ALTER TABLE group5.main
ADD CONSTRAINT work_year_fk_listing
FOREIGN KEY (work_year_id)
REFERENCES group5.work_year (work_year_id)
ON DELETE CASCADE;

```

## View of MAIN Table After ALTER & UPDATE

```sql
SELECT * FROM group5.main LIMIT 5;
```

```bash
i
 listing_id | company_location | salary | remote_ratio | company_size | employee_residence |     job_title     | employment_type | experience_id | work_year_id
------------+------------------+--------+--------------+--------------+--------------------+-------------------+-----------------+---------------+--------------
         44 | US               | 110680 |            0 | L            | US                 | Applied Scientist | FT              |             3 |            1
         45 | US               | 270703 |            0 | M            | US                 | Data Engineer     | FT              |             1 |            1
         46 | US               | 221484 |            0 | M            | US                 | Data Engineer     | FT              |             1 |            1
         47 | US               | 212750 |          100 | M            | US                 | Data Scientist    | FT              |             1 |            1
         48 | US               | 185000 |          100 | M            | US                 | Data Scientist    | FT              |             1 |            1
(5 rows)
```
